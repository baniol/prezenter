!function(){var a,b;a=function(){function a(a){var b,c,d,e,f,g,h,i,j,k,l;null==a&&(a={}),b=null!=(c=a.animation)?c:"pulse",this.loop=null!=(d=a.loop)?d:!1,this.outroText=null!=(e=a.outroText)?e:!1,this.autoStart=null!=(f=a.autoStart)?f:!1,this.controlsOffset=null!=(g=a.controlsOffset)?g:0,this.introText=null!=(h=a.introText)?h:null,this.moveSpeed=null!=(i=a.moveSpeed)?i:800,this.onEachStep=null!=(j=a.onEachStep)?j:null,this.onStart=null!=(k=a.onStart)?k:null,this.onEnd=null!=(l=a.onEnd)?l:null,this.data=prez_data,this.debug=!0,this.currentStep=0,this.animation="pulse",this.viewportDim={width:$(document).width(),height:$(document).height()},this.cursor=$('<div class="prez-cursor" >⬆</div>'),this.cursorInitialPosition={},this.frame=$('<div class="prez-frame animated '+b+'" />'),this.startButton=$('<div class="prez-start-btn prez-btn">➡</div>'),this.closeBtn=$('<div class="prez-end-close-btn prez-btn">✖</div>'),this.tip=$('<div class="prez-tooltip" />'),this.body=$("body"),this.grid=[],this.currentElement=null,this.framePadding=10,this.cursorSpacing=5,this.currsorDims={},this.VERSION="0.0.2",$.isArray(this.makeGrid())&&(this.appendControls(),("always"===this.autoStart||"once"===this.autoStart&&null==window.localStorage.prezenter_mark_done)&&this.showCtrl.click())}return a.prototype.log=function(a){return this.debug?"undefined"!=typeof console&&null!==console?console.log(a):void 0:void 0},a.prototype.init=function(a){var b=this;return this.showIntroText(a,function(){b.placeCursor(),b.showFrame(),b.showTip(),b.bindKeys(),"function"==typeof b.onEachStep&&b.onEachStep(b.currentStep+1)})},a.prototype.showIntroText=function(a,b){return"function"==typeof this.onStart&&null==a&&this.onStart(),this.introText&&null==a?this.showPopup(this.introText):b()},a.prototype.makeGrid=function(){var a,b,c,d,e,f,g,h,i;for(g=this.data,e=0,f=g.length;f>e;e++){if(c=g[e],d=$(c.selector),b=this.calculateElementDimensions(d),0===d.length)throw"the element "+c.selector+" does not exist";a={selector:c.selector,text:c.text,offset:{top:null!=(h=d.offset())?h.top:void 0,left:null!=(i=d.offset())?i.left:void 0},width:b.width,height:b.height,scroll:c.scroll,cursorPosition:null!=c.position?c.position:"left",fn:c.fn},this.grid.push(a)}return this.grid},a.prototype.calculateElementDimensions=function(a){var b;return b={width:this.getInt(a.css("padding-left"))+this.getInt(a.css("padding-right"))+a.width(),height:this.getInt(a.css("padding-top"))+this.getInt(a.css("padding-bottom"))+a.height()}},a.prototype.getInt=function(a){var b;return b=a.replace("px",""),parseInt(b,10)},a.prototype.appendControls=function(){var a=this;return this.ctrlWrapper=$('<div class="prez-ctrl-wrapper" />'),this.ctrlPrevButton=$('<div class="prez-btn btn-left prez-ctrl-prev">«</div>'),this.ctrlNextButton=$('<div class="prez-btn btn-right prez-ctrl-next">»</div>'),this.ctrlCloseButton=$('<div class="prez-btn prez-ctrl-close">✖</div>'),this.showCtrl=$('<div class="prez-show">?</div>'),this.ctrlWrapper.append(this.ctrlPrevButton),this.ctrlWrapper.append(this.ctrlNextButton),this.ctrlWrapper.append(this.ctrlCloseButton),this.ctrlWrapper.append(this.showCtrl),this.body.append(this.ctrlWrapper),this.ctrlWrapperHeight=this.ctrlWrapper.height()+this.getInt(this.ctrlWrapper.css("padding-top"))+this.getInt(this.ctrlWrapper.css("padding-bottom")),this.ctrlWrapper.css({x:this.controlsOffset+"px",y:"-"+this.ctrlWrapperHeight+"px"}),this.showCtrl.on("click",function(){return a.ctrlWrapper.transition({y:10},300,"ease"),a.showCtrl.hide(),a.bindControls(),a.init()})},a.prototype.bindControls=function(){var a=this;return this.ctrlPrevButton.on("click",function(){return a.nextStep(!0)}),this.ctrlNextButton.on("click",function(){return a.tip.hasClass("intro")?a.init(!0):a.nextStep()}),this.ctrlCloseButton.on("click",function(){return a.showCtrl.show(),a.presentationEnd(!0)})},a.prototype.unbindControls=function(){return this.ctrlPrevButton.off("click"),this.ctrlNextButton.off("click"),this.ctrlCloseButton.off("click")},a.prototype.bindKeys=function(){var a=this;return this.unbindKeys(),$(document).on("keyup",function(b){return 37===b.keyCode&&a.nextStep(!0),39===b.keyCode?a.nextStep():void 0})},a.prototype.unbindKeys=function(){return $(document).off("keyup")},a.prototype.placeCursor=function(){var a,b;switch(this.currentElement=this.grid[0],this.cursor.transition({x:0,y:0}),this.body.append(this.cursor),this.currsorDims={width:this.cursor.width(),height:this.cursor.height()},this.currentElement.cursorPosition){case"bottom":this.cursor.css({left:this.currentElement.offset.left+this.currentElement.width/2-this.currsorDims.width/2,top:this.currentElement.offset.top+this.currentElement.height+this.framePadding+this.cursorSpacing});break;case"top":this.cursor.css({rotate:"180deg"}),this.cursor.css({left:this.currentElement.offset.left+this.currentElement.width/2-this.currsorDims.width/2,top:this.currentElement.offset.top-this.currsorDims.height-this.framePadding-this.cursorSpacing});break;case"right":this.cursor.css({rotate:"-90deg"}),this.cursor.css({left:this.currentElement.offset.left+this.currentElement.width+this.framePadding+this.cursorSpacing,top:this.currentElement.offset.top-this.framePadding});break;default:this.cursor.css({rotate:"90deg"}),this.cursor.css({left:this.currentElement.offset.left-this.framePadding-this.currsorDims.width-this.cursorSpacing,top:this.currentElement.offset.top-this.framePadding})}return this.cursor.css("visibility","visible"),a=null!=this.currentElement.scroll?this.currentElement.scroll:0,b=this.currentElement.offset.top-20-a,this.cursorInitialPosition={left:this.cursor.offset().left,top:this.cursor.offset().top},$("html, body").animate({scrollTop:b},400)},a.prototype.nextStep=function(a){var b,c,d,e,f=this;if(0!==this.currentStep||null==a){if(this.unbindControls(),this.unbindKeys(),this.currentStep>this.grid.length-2)if(this.loop)this.currentStep=-1;else if(null==a)return this.presentationEnd(),!1;return this.frame.remove(),this.tip.remove(),c=this.calculateDifference(a),null!=a?this.currentStep--:this.currentStep++,this.currentElement=this.grid[this.currentStep],this.cursor.transition({x:c.x,y:c.y},this.moveSpeed,"ease"),d=null!=a?1:-1,-1===this.currentStep+d&&(d=1),0===this.currentStep&&null==a&&(d=this.grid.length-1),this.rotateCursor(d),b=null!=this.currentElement.scroll?this.currentElement.scroll:0,e=this.currentElement.offset.top-20-b,$("html, body").animate({scrollTop:e},400),setTimeout(function(){return f.showFrame(),f.showTip(),f.bindKeys(),f.bindControls(),"function"==typeof f.onEachStep&&f.onEachStep(f.currentStep+1),"function"==typeof f.currentElement.fn?f.currentElement.fn(f.tip,f.frame,f.cursor):void 0},this.moveSpeed)}},a.prototype.showFrame=function(){return this.frame.css({top:this.currentElement.offset.top-this.framePadding,left:this.currentElement.offset.left-this.framePadding,width:this.currentElement.width+2*this.framePadding,height:this.currentElement.height+2*this.framePadding}),this.body.append(this.frame)},a.prototype.showTip=function(){var a,b,c,d;switch(this.tip.html('<div class="prez-popup-text">'+this.currentElement.text+"</div>"),this.tip.removeClass("intro"),this.tip.removeClass("outro"),this.body.append(this.tip),b=this.currentElement.width+2*this.framePadding,a=this.currentElement.height+2*this.framePadding,d=this.tip.width()+2*this.framePadding,c=this.tip.height()+2*this.framePadding,this.currentElement.cursorPosition){case"bottom":return this.tip.css({left:this.currentElement.offset.left+(this.currentElement.width-d)/2,top:this.currentElement.offset.top+this.currentElement.height+this.framePadding+this.currsorDims.height+2*this.cursorSpacing});case"top":return this.tip.css({left:this.currentElement.offset.left+(this.currentElement.width-d)/2,top:this.currentElement.offset.top-3*this.framePadding-2*this.cursorSpacing-this.currsorDims.height-this.tip.height()});case"right":return this.tip.css({left:this.currentElement.offset.left+this.currentElement.width+this.currsorDims.width+this.framePadding+2*this.cursorSpacing,top:this.currentElement.offset.top-this.framePadding});default:return this.tip.css({left:this.currentElement.offset.left-3*this.framePadding-this.tip.width()-this.currsorDims.width-2*this.cursorSpacing,top:this.currentElement.offset.top-this.framePadding})}},a.prototype.calculateDifference=function(a){var b,c,d,e,f;switch(e=null!=a?-1:1,f=this.grid[this.currentStep+e],f.cursorPosition){case"bottom":b=f.width/2-this.currsorDims.width/2,c=f.height+this.framePadding+this.cursorSpacing;break;case"top":b=f.width/2-this.currsorDims.width/2,c=-this.currsorDims.height-this.framePadding-this.cursorSpacing;break;case"right":b=f.width+this.framePadding+this.cursorSpacing,c=-this.framePadding;break;default:b=-this.framePadding-this.currsorDims.width-this.cursorSpacing,c=-this.framePadding}return d={x:f.offset.left-this.cursorInitialPosition.left+b,y:f.offset.top-this.cursorInitialPosition.top+c}},a.prototype.presentationEnd=function(a){return null==a&&(a=!1),this.unbindControls(),this.startButton.off("click"),"function"==typeof this.onEnd&&this.onEnd(),this.frame.remove(),this.cursor.remove(),this.currentStep=0,this.outroText&&!a?this.showPopup(this.outroText):this.tip.remove(),a&&($(document).off("click",".prez-end-close-btn"),this.ctrlWrapper.transition({y:-this.ctrlWrapperHeight},300,"ease")),this.unbindKeys(),this.markDone()},a.prototype.showPopup=function(a){var b,c,d,e,f,g,h=this;return g=$(document).width(),f=$(document).height(),this.tip.css("visibility","hidden"),this.tip.empty(),b='<div class="prez-close-text" >'+a+"</div>",0===this.body.find(".prez-tooltip").length?(this.body.append(this.tip),this.tip.addClass("intro"),this.tip.append($('<div class="prez-popup-text">'+this.introText+"</div>")),this.tip.append(this.startButton),this.startButton.on("click",function(){return h.init(!0)}),$(document).on("keyup",function(a){return 39===a.keyCode?h.startButton.click():void 0})):(this.tip.append(this.closeBtn),this.tip.append($('<div class="prez-popup-text">'+b+"</div>")),this.tip.addClass("outro"),this.closeBtn.on("click",function(){return h.tip.remove(),$(document).off("click",".prez-end-close-btn"),h.ctrlWrapper.transition({y:-h.ctrlWrapperHeight},300,"ease"),h.showCtrl.show()})),e=this.tip.width(),d=this.tip.height(),c=200,this.tip.css({top:c,left:g/2-e/2}),$("html, body").animate({scrollTop:0},400),this.tip.css("visibility","visible")},a.prototype.rotateCursor=function(a){return"left"===this.currentElement.cursorPosition&&"bottom"===this.grid[this.currentStep+a].cursorPosition&&this.cursor.css({rotate:"+=90"}),"top"===this.currentElement.cursorPosition&&"left"===this.grid[this.currentStep+a].cursorPosition&&this.cursor.css({rotate:"+=90"}),"top"===this.currentElement.cursorPosition&&"bottom"===this.grid[this.currentStep+a].cursorPosition&&this.cursor.css({rotate:"+=180"}),"bottom"===this.currentElement.cursorPosition&&"top"===this.grid[this.currentStep+a].cursorPosition&&this.cursor.css({rotate:"-=180"}),"top"===this.currentElement.cursorPosition&&"right"===this.grid[this.currentStep+a].cursorPosition&&this.cursor.css({rotate:"-=90"}),"right"===this.currentElement.cursorPosition&&"top"===this.grid[this.currentStep+a].cursorPosition&&this.cursor.css({rotate:"+=90"}),"left"===this.currentElement.cursorPosition&&"top"===this.grid[this.currentStep+a].cursorPosition&&this.cursor.css({rotate:"-=90"}),"left"===this.currentElement.cursorPosition&&"right"===this.grid[this.currentStep+a].cursorPosition&&this.cursor.css({rotate:"+=180"}),"bottom"===this.currentElement.cursorPosition&&"left"===this.grid[this.currentStep+a].cursorPosition&&this.cursor.css({rotate:"-=90"}),"bottom"===this.currentElement.cursorPosition&&"right"===this.grid[this.currentStep+a].cursorPosition&&this.cursor.css({rotate:"+=90"}),"right"===this.currentElement.cursorPosition&&"bottom"===this.grid[this.currentStep+a].cursorPosition&&this.cursor.css({rotate:"-=90"}),"right"===this.currentElement.cursorPosition&&"left"===this.grid[this.currentStep+a].cursorPosition?this.cursor.css({rotate:"-=180"}):void 0},a.prototype.markDone=function(){return window.localStorage.setItem("prezenter_mark_done",!0)},a}(),b="undefined"!=typeof exports&&null!==exports?exports:window,b.Prezenter=a}.call(this);